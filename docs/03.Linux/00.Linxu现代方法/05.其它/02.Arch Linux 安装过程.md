---
title: Arch Linux 安装过程
date: 2022-04-17 19:20:20
permalink: /pages/affb3e/
tags:
  - 
---
本次安装过程基于下面的教程，不少内容都是复制该教程里面的。
> 图文详解：[https://www.linuxmi.com/arch-linux-anzhuang.html](https://www.linuxmi.com/arch-linux-anzhuang.html)

<img src="https://cdn.jsdelivr.net/gh/JimFKppt/Pictures@master/static_files/img/image%20(2).png" alt="image (2)" style="zoom:33%;" />

> Arch Linux ISO 下载：[https://archlinux.org/download/](https://archlinux.org/download/)

### 启动 Arch ISO
> ！VirtualBox 用户和 VMware 用户必须在开始安装之前在虚拟机设置中启用 EFI 或 UEFI 引导。否则在尝试安装 GRUB 引导加载程序时会发生错误。（VMware 默认使用 boot 引导）
> 如果是实体机安装，请另外准备 Live Bootable USB（可以使用 Etcher 或 Ventoy 等应用程序）

- 启动到 Arch ISO 后，选择`Arch Linux install medium (x86_64, UEFI)`选项并点击`Enter`
- 安装程序解压并加载 Linux 内核后， 您将自动跳转到具有 root 权限的终端
### 验证与 Internet 的连接

- 只需 ping 一个网站
> 如果收到一个错误信息，请检查你的互联网连接或路由器
> 检查网络：
> - 输入`ip a`指令检查
> 
这里用的是有线连接，如果你用的是无线连接需要按照下面的步骤连接到无线网：
> - 输入`iwctl`
> - 进入`iwd`模式，输入`device list`
> 
查看你的网卡名字，这里假设是wlan0，输入
> - `station wlan0 scan`
> 
检查扫描网络，输入
> - `station wlan0 get-networks`
> 
查看网络名字，假设名字叫linuxmi，输入
> - `station wlan0 connect linuxmi`
> 
接着输入密码（如果有密码的话），输入
> - `exit`
> 
退出`iwd`模式
> 连接成功之后，检查可以连接到pacman源

### 对磁盘进行分区
> 如果您不熟悉诸如 fdisk 之类的分区工具，那么您很可能会在这里遇到最大的麻烦 cfdisk

- `fdisk -l` 列出磁盘阵列
> 出于本指南的目的，我们创建一个虚拟机，其中包含一个由 /dev/sda。更改/dev/sda为您的设备名称。
> 对于基本分区，我们需要创建以下分区布局：
> - /dev/sda1: EFI 系统分区，大小为 512 MB（通常设为 1G），FAT32 格式。这为存储引导加载程序和引导所需的其他文件提供了空间。
> - /dev/sda2：交换分区，4GB 大小。交换空间用于将虚拟内存扩展到已安装的物理内存 (RAM) 之外，或用于挂起磁盘支持。
> - /dev/sda3：Linux分区，剩余可用磁盘空间大小，EXT4格式。这是存储我们的 Arch Linux 操作系统、文件和其他信息的根 (/) 分区。

#### 创建 EFI 系统分区
> 通过 `cfdisk` 对机器硬盘驱动器运行命令来实际开始创建磁盘布局分区表

- `cfdisk /dev/sda` 
- 选择`GPT`标签并点击`enter`
- 选择 `Free Space` 并点击 `New`
- 以 MB (`1024M`) 为单位键入分区大小，然后按Enter键，创建出 `/dev/sda1` 分区
- 在`/dev/sda1`分区仍然被选中的情况下，从底部菜单中选择`Type`并选择`EFI System`分区类型
> 现在，您已完成 EFI 系统分区的配置

#### 创建 swap 分区
> 使用相同的过程创建 swap 分区

- 再次选择剩余的`Free space`和 并点击`New`
- 以 GB (`4G`) 为单位键入分区大小，然后按`Enter`键，创建出 `/dev/sda2` 分区
- 在`/dev/sda2`分区仍然被选中的情况下，从底部菜单中选择`Type`并选择`Linux swap`分区类型
> 现在，您已经完成了 Swap 分区的配置

#### 创建 / 分区

- 选择剩余的`Free space`和 并点击`New`
- 对于 (`/`) 大小，保留默认大小值。这意味着，所有剩余的可用空间。按`Enter`键
- 在`/dev/sda3`分区仍然被选中的情况下，从底部菜单中选择`Type`并选择`Linux filesystem`分区类型
> 现在，您已经完成了 / 分区的配置

#### 将更改写入磁盘
> 接下来，您需要保存所做的更改

- 选择`Write`从底部菜单和命中`Enter`
- 键入`yes`并按下`Enter`键
- 到此结束，选择`Quit`并按下`Enter`即可
### 创建文件系统
现在您已准备好磁盘分区，是时候在其上创建[文件系统](https://linuxiac.com/linux-file-system-types-explained-which-one-should-you-use/)了。首先通过运行`fdisk -l`来查看分区表摘要。
> 该/dev/sda磁盘应该有三个分区（/dev/sda1，dev/sda2，和/dev/sda3）
> 前面步骤中分区的创建只是在硬盘提供的存储空间上划出边界，并指定了每条边界线之间的空间类型。现在，是时候用所需的文件系统格式化分区了。
> 我们必须在这里创建 3 个文件系统，所以让我们开始吧。

对于 EFI 分区类型，创建一个 FAT32 文件系统：

- `mkfs.fat -F32 /dev/sda1`

对于 swap 分区：

- `mkswap /dev/sda2`
- `swapon /dev/sda2`

对于根分区，创建一个 ext4 文件系统：

- `mkfs.ext4 /dev/sda3`
### 安装 Arch Linux
同步 pacman 存储库，以便您可以下载和安装软件：

- `pacman -Syy`

必须先将根分区 ( /dev/sda3)挂载到 /mnt目录中，然后才能执行所有的安装。

- `mount /dev/sda3 /mnt`

安装根分区后，是时候安装所有必要的包了。使用该 `pacstrap` 命令安装 Arch Linux 所需的软件包。

- `pacstrap /mnt base linux linux-firmware sudo nano`
### 配置已安装的 Arch 系统
安装完成后，通过发出以下命令为您的新 Arch Linux 系统生成 `fstab` 文件：

- `genfstab -U /mnt >> /mnt/etc/fstab`

现在我们已经安装了 Arch Linux，我们需要使用  命令切换到物理安装的根分区`arch-chroot`。

- `arch-chroot /mnt`![image.png](https://cdn.nlark.com/yuque/0/2021/png/12900083/1639374326719-b7614a74-c43d-405b-b83c-fee26c39e4bd.png#clientId=u2fe5807b-1cdb-4&crop=0&crop=0&crop=1&crop=1&from=drop&height=69&id=uf28f3ce2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=160&originWidth=1527&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34967&status=done&style=none&taskId=u3f2daf6d-eed4-4cd2-bf80-58e6f0bbf47&title=&width=663.0113525390625)
> 如果执行`arch-chroot /mnt`后提示 `chroot failed to run command /bin/bash : no such file or directory`，可能是没有安装完全，执行 `pacstrap /mnt base` 确保安装包安装完毕

#### 配置时区
> 要查找您的时区，您可以执行 `ls -l/usr/share/zoneinfo/`列出目录的内容 ，找到您的首选时区
> 创建一个符号链接来设置时区（将“ America/New_York”替换为您的时区）
> `ln -sf /usr/share/zoneinfo/America/New_York /etc/localtime`

例如，上海：

- `ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime`
#### 设置 locale 文件
该文件 `/etc/locale.gen` 包含区域设置和系统语言，并在默认情况下被注释。我们必须使用文本编辑器打开此文件并取消注释包含所需语言环境的行。

- `nano /etc/locale.gen`

把`/etc/locale.gen`中 `en_US.UTF-8 UTF-8`、`en_US ISO-8859-1`和`zh_CN.UTF-8 UTF-8`的注释取消
> 如果没有安装 nano 编辑器，可以执行`pacman -S nano`安装 nano，使用 vim 编辑器亦可。

现在使用以下命令一一生成语言环境配置文件：

- `locale-gen`

创建并设置 LANG 变量：

- `echo LANG=zh_CN.UTF-8 > /etc/locale.conf`
- `export LANG=zh_CN.UTF-8`
> 此后系统中可能会出现**乱码**，可以当下解决，亦可完成系统安装后再来解决
> 安装中文字体解决 Arch Linux 中文乱码：
> - `pacman -S wqy-zenhei ttf-fireflysung` 
> 
(flash乱码) —乱码的原因就是缺少中文字体的支持，下载文泉驿xx， OK了

#### 设置主机名

- `echo [YourHostName] > /etc/hostname`

您还需要将此名称添加到 `/etc/hosts` 文件中：

- `nano /etc/hosts`

内容如下：
> 127.0.0.1     localhost
> ::1               localhost
> 127.0.0.1    [YourHostName]

![image.png](https://cdn.nlark.com/yuque/0/2021/png/12900083/1639376544917-78a41a69-98aa-4eee-b2cc-9f5ba0818f46.png#clientId=u2fe5807b-1cdb-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=129&id=u0ba83a93&margin=%5Bobject%20Object%5D&name=image.png&originHeight=258&originWidth=817&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43615&status=done&style=none&taskId=u3867b04c-2edb-4504-9971-19fbdaad79d&title=&width=408.5)
#### 设置 root 用户密码

- `passwd`

### 安装 GRUB 引导程序
> 现在我们安装引导加载程序，以便 Arch 在重新启动后启动。Linux 发行版和 Arch Linux 的默认引导加载程序也由 GRUB 包表示。

安装 GRUB 引导加载程序和 EFI 引导管理器包：

- `pacman -S grub efibootmgr os-prober mtools`

然后创建挂载点 /dev/sda1并挂载它：

- `mkdir /boot/efi`
- `mount /dev/sda1 /boot/efi`

现在让我们安装我们的引导加载程序：

- `grub-install --target=x86_64-efi --bootloader-id=grub_uefi`

如果顺利：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/12900083/1639377679823-1f689cc6-8662-4477-9c61-95c4915cc473.png#clientId=u2fe5807b-1cdb-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=65&id=u4772bb06&margin=%5Bobject%20Object%5D&name=image.png&originHeight=130&originWidth=1613&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32918&status=done&style=none&taskId=u5929cedb-1e46-4c62-93d3-22d1b31c7b0&title=&width=806.5)
不顺利的话：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/12900083/1639377750379-2d92b8dd-8660-4376-bd26-0da816150c2e.png#clientId=u2fe5807b-1cdb-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=123&id=u77c7d19e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=246&originWidth=2479&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72997&status=done&style=none&taskId=u021ff792-55a7-4ecf-aa53-2fcc703a12d&title=&width=1239.5)
> 如果是虚拟安装，一定要以 UEFI 引导，VMware 默认以 boot 引导
> 如果是实体机，则检查主机是否支持 UEFI，是否可以进入 BIOS 就该为 UEFI 引导模式

最后，生成 `/boot/grub/grub.cfg` 文件：

- `grub-mkconfig -o /boot/grub/grub.cfg`

### 安装桌面环境
> 目前，Arch Linux 系统仅包含从命令行管理系统所需的基本软件包，没有 GUI（图形用户界面）。
> 有许多桌面环境可以与 Arch Linux 一起使用。
> 现在，将安装GNOME作为安装桌面环境示例。

第一步是安装 X 环境。键入以下命令将 `Xorg` 安装为显示服务器：

- `pacman -S xorg-server xorg-apps`

然后安装一个合适的显卡驱动程序。
Nvidia用户：

- `pacman -S nvidia nvidia-utils`

AMD 用户：

- `pacman -S xf86-video-amdgpu`

英特尔用户：

- `pacman -S xf86-video-intel`

现在，您可以使用以下命令在 Arch Linux 上安装 GNOME 桌面环境：

- `pacman -S gnome gnome-extra networkmanager`
> GNOME 为下载提供了一个选择。对于每个提示，选择适当的提供者并按Enter继续。如果您不确定，只需按Enter接受默认值。

启用 GDM 显示管理器和网络管理器：

- `systemctl enable gdm`
- `systemctl enable NetworkManager`

### 创建一个普通用户帐户
用户帐户的创建方法也会自动为用户创建主目录。另外，我们可以给这个账号 sudo 权限。

- `useradd -m -G wheel [UserName]`

请务必为新用户设置密码：

- `passwd [UserName]`

接下来，为新创建的用户启用 sudo 权限：

- `EDITOR=nano visudo`

向下滚动屏幕并找到以下行：
# %wheel ALL=(ALL) ALL
通过删除`#`符号取消注释。

### 完成 Arch Linux 系统安装
现在我们已经完成了 Arch Linux 的安装，所以我们现在将从终端退出并卸载我们的根分区并重新启动到我们新安装的 Arch Linux 系统。

- `exit`
- `umount -R /mnt`
- `reboot`

到这一步了，你可以安装你想要的东西并根据需要配置你的 Arch Linux。
